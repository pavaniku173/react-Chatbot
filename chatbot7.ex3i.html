<!DOCTYPE html>
<html>
    <head>
        <title>
            Chatbot Application
        </title>
    </head>
    <body>
        <div class="js-container"></div>

        <script src="https://unpkg.com/supersimpledev/react.js"></script>
        <script src="https://unpkg.com/supersimpledev/react-dom.js"></script>
        <script src="https://unpkg.com/supersimpledev/chatbot.js"></script>

    
        <script src="https://unpkg.com/supersimpledev/babel.js"></script>
        <script type="text/babel">

            function ChatInput({chatMessages, setChatMessages}){
                const [inputText, setInputText]=React.useState('');
                
                function saveInputText(event){
                    //console.log(event.target.value);
                    setInputText(event.target.value);

                }
                async function sendMessage(){
                    setInputText(''); //clear input box immediately after clicking send button
                    
                    const newChatMessages=                         [
                        ...chatMessages,
                        {
                            //message: 'how to use hooks?',
                            message: inputText,
                            sender: 'user',
                            id: crypto.randomUUID()
                        }
                    ];


                    setChatMessages(newChatMessages);
          setChatMessages([
            ...newChatMessages,
            // This creates a temporary Loading... message.
            // Because we don't save this message in newChatMessages,
            // it will be remove later, when we add the response.
            {
              message: 'Loading...',
              sender: 'robot',
              id: crypto.randomUUID()
            }
          ]);
                    //console.log(inputText);
                    //setChatMessages(newChatMessages);
                    //const response = Chatbot.getResponse(inputText);
                   const response= await Chatbot.getResponseAsync(inputText);
                   //console.log(response);
                   setChatMessages([
                        ...newChatMessages,
                        {
                            //message: 'how to use hooks?',
                            message: response,
                            sender: 'robot',
                            id: crypto.randomUUID()
                        }
                    ]);
                        setInputText('');
                }
                function pressKey(event){
                    if(event.key==='Enter'){
                        sendMessage();
                    }else if(event.key==='Escape'){
                        setInputText('');
                    }

                }
                return(
                    <>
                    <input placeholder="send a message to chatbot" 
                    size="30" onChange={saveInputText} 
                    value={inputText}
                    onKeyDown={pressKey} className="    "/>
                
                    <button onClick={sendMessage}>Send</button>
                    </>
                )
            }
            
            function ChatMessage({message, sender}){ //destructuring assignment
                 return(
                    <div>
                        {sender==='robot' && <img src="robot.png" width="50px" />}
                        {message}
                    { sender ==='user' && <img src="user.png" width="50px" />}
                    </div>
                );
            }
           function ChatMessages({chatMessages}){
            
                return(
                <>
                    {chatMessages.map((chatMessage)=>{      //generate the UI/html
                        return (
                            <ChatMessage
                                message={chatMessage.message}
                                sender={chatMessage.sender}
                                key={chatMessage.id}
                            />
                        );
                    })}
                </>
            );
        }

        
            function App(){
                const [chatMessages, setChatMessages]= React.useState([
                {
                    message: "hello chatbot",
                    sender: "user",
                    id:"id1"

                },
                {
                    message: "Hello! How can I help you?",
                    sender: "robot",
                    id:"id2"
                },
                {
                    message: "can you get me todays date",
                    sender: "user",
                    id:"id3"
                },
                {
                    message: "Today is September 26",
                    sender: "robot",
                    id:"id4"
                },
                {
                    message: "how about coin flip?",
                    sender: "user",
                    id:"id5"
                },
                {
                    message: "Sure! You got tails",
                    sender: "robot",
                    id:"id6"
                

            }]);
            
                return (
                <>
                    <ChatInput chatMessages={chatMessages}  setChatMessages={setChatMessages}/>
                    <ChatMessages  chatMessages={chatMessages}/>
                </>
                );
            }
            
            const container = document.querySelector('.js-container');
            ReactDOM.createRoot(container).render(<App />);

        </script>
    </body>
</html>